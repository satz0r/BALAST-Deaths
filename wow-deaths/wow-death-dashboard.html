<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BALAST Guild - Death Analytics Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://esm.sh/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .stat-card h3 {
            margin: 0 0 10px 0;
            color: #4ecdc4;
        }
        
        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #ff6b6b;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .control-group label {
            font-weight: bold;
            color: #4ecdc4;
        }
        
        select, input {
            padding: 8px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 14px;
        }
        
        select option {
            background: #16213e;
            color: white;
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .chart-container h3 {
            margin: 0 0 20px 0;
            color: #4ecdc4;
            text-align: center;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid #4ecdc4;
            max-width: 200px;
        }
        
        .axis {
            font-size: 12px;
        }
        
        .axis text {
            fill: #ffffff;
        }
        
        .axis path,
        .axis line {
            stroke: #ffffff;
            stroke-width: 1;
        }
        
        .bar {
            transition: opacity 0.3s;
        }
        
        .bar:hover {
            opacity: 0.7;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>⚔️ BALAST Guild Death Analytics ⚔️</h1>
            <p>Hardcore WoW Deaths Analysis Dashboard</p>
        </div>
        
        <div class="stats-overview" id="stats-overview">
            <!-- Stats will be populated here -->
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label>Class Filter:</label>
                <select id="classFilter">
                    <option value="all">All Classes</option>
                </select>
            </div>
            <div class="control-group">
                <label>Level Range:</label>
                <select id="levelFilter">
                    <option value="all">All Levels</option>
                    <option value="1-20">1-20</option>
                    <option value="21-40">21-40</option>
                    <option value="41-59">41-59</option>
                    <option value="60">Level 60</option>
                </select>
            </div>
            <div class="control-group">
                <label>Location:</label>
                <select id="locationFilter">
                    <option value="all">All Locations</option>
                </select>
            </div>
            <div class="control-group">
                <label>Raid Deaths Only:</label>
                <select id="raidFilter">
                    <option value="all">All Deaths</option>
                    <option value="yes">Raid Deaths Only</option>
                    <option value="no">Non-Raid Deaths</option>
                </select>
            </div>
        </div>
        
        <div class="charts-container">
            <div class="chart-container">
                <h3>Deaths by Class</h3>
                <div id="classChart"></div>
            </div>
            <div class="chart-container">
                <h3>Deaths by Level Range</h3>
                <div id="levelChart"></div>
            </div>
            <div class="chart-container full-width">
                <h3>Death Timeline</h3>
                <div id="timelineChart"></div>
            </div>
            <div class="chart-container">
                <h3>Most Dangerous Locations</h3>
                <div id="locationChart"></div>
            </div>
            <div class="chart-container">
                <h3>Deadliest Mobs</h3>
                <div id="mobChart"></div>
            </div>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>

    <script>
        // Parse the CSV data
        const csvData = `Date,Character Name,Class,Lvl,Specific Loc,Location,Mob,Other,Raid,Video Link,
22 Nov 24,Sosemi ,Paladin,19,,Deadmines,Defias Worker,DC,,,
22 Nov 24,Holyfett,Priest,20,,Deadmines,Defias Worker,DC,,,
22 Nov 24,Dantres,Rogue,21,,Deadmines,Defias Worker,DC,,,
23 Nov 24,Chillydruid,Druid,17,,Westfall,Riverpaw Bandit,,,https://www.twitch.tv/videos/2308467831,
26 Nov 24,Denta ,Warrior,,,,,,,,
27 Nov 24,Sander,,,,,,,,,
27 Nov 24,Monza,Warrior,35,,,,,,,
28 Nov 24,Burningmage,Mage,28,,,,,,,
29 Nov 24,Ignite,Mage,60,,Zul'Farrak,Zul'Farrak Zombie,,,,
2 Dec 24,Munzi,,,,,,,,,
3 Dec 24,Chillybear,Druid,38,,Desolace,Undead Ravager,,,,
5 Dec 24,Nullandvoid,Priest,53,The Slithering Scar,Un'goro Crator ,Gorishi Hive Guard,,,,
9 Dec 24,Reprieve,Priest,54,,Blasted Lands,Teremus the Devourer,,,,
10 Dec 24,Herra,,51,,Maraudon,Princess Theradras,,,,
10 Dec 24,Holynight,,60,Southwind Village,Silithus,Hive'Ashi Drone,,,,
12 Dec 24,Dirytbstrd,Rogue,54,,Eastern Plaguelands,Ghost of the Past,,,,
12 Dec 24,Mepcsa,Warrior,46,,Uldaman,Archaedas,,,,
15 Dec 24,Dantres,Rogue,53,,Eastern Plaguelands,,,,,
15 Dec 24,Azem,,40,The Wild Shore,Stranglethorn Vale,Bloodsail Sea Dog,,,,
15 Dec 24,Thesniffler,,41,Booty Bay,Stranglethorn Vale,,Drowning,,,
15 Dec 24,Brorock,,13,Menethil Bay,Wetlands,Wetlands Crocolisk,,,,
15 Dec 24,Brotuck,,,,,,,,,
18 Dec 24,Holyfett,Priest,55,,Felwood,Jaedenar Legionnaire,Layered,,,
21 Dec 24,Nhexx,Priest,60,,Stratholme,Ezra Grimm,,,,
21 Dec 24,Jööti,Mage,60,Hearthglen,Western Plaguelands,Foreman Jerris,,,,
22 Dec 24,Hiddenknob,Paladin,,,,,Fall Damage,,,
23 Dec 24,Frostey,Warrior,18,,Redbridge Mountain,Bellygrub,,,,
24 Dec 24,Moncola,Warrior,60,,Scholomance,Scholomance Necrolyte,,,https://discord.com/channels/1151689920105164910/1158912037502599280/1321264405912223746,
24 Dec 24,Burningrogue,Rogue,60,,Scholomance,,,,,
26 Dec 24,Barney,,54,Shrine of the Deceiver,Felwood,Jaedenar Guardian,,,,
29 Dec 24,Vogelgrippe,,,,,,,,,
30 Dec 24,Zor,Hunter,60,,Burning Steps,Klinfran the Crazed,,,,
30 Dec 24,Alenda ,Mage,60,Hearthglen,Western Plaguelands,Foreman Jerris,,,https://www.youtube.com/watch?v=B99oziAAsiU&t=1s,
31 Dec 24,Adegen,,60,,Eastern Plaguelands,Grave Robber,,,,
1 Jan 25,Volkóv,Warrior,54,Irontree Woods,Felwood,,Fall Damage,,,
4 Jan 25,Grymmlork,Druid,60,,Stratholme,Skeletal Berserker,,,,
10 Jan 25,Missreq,,,,,,,,,
12 Jan 25,Lulalu,Warrior,60,,Dire Maul,Gordok Brute,,,,
12 Jan 25,Reprievex,Priest,52,The Forgotten Coast,Feralas,Deep Strider,,,,
17 Jan 25,Fatjoel,,46,Lost Rigger Cove,Tanaris,Southsea Dock Worker,,,,
17 Jan 25,Frostey,Rogue,15,,Westfall,Fleshripper,,,,
17 Jan 25,Scyllax,,48,,Zul'Farrak,Sandfury Blood Drinker,,,,
18 Jan 25,Napzhui,,,,Dire Maul,,,,,
20 Jan 25,Dantres,Rogue,60,,Dire Maul,,DC,,,
20 Jan 25,Kensto,Priest,60,,Winterspring,Scryer,,,https://medal.tv/games/wow-classic/clips/jwW2gHQmENdyITIhL?invite=cr-MSwzaUssMjcxMjU0ODM2LA,
24 Jan 25,Vólkóv,Warrior,60,,Stratholme,Archivist Galford,,,,
25 Jan 25,Shayur,Druid,60,,Scholomance,Reanimated Corpse,,,https://www.twitch.tv/herrfate/clip/NaiveUnusualOpossumSSSsss-dbjWeYQP5g0mNuN3,https://www.twitch.tv/herrfate/clip/AwkwardDarlingPorpoiseWow-cNs3ujwySDrNDJw9
26 Jan 25,Grymmrage,Druid,59,,Blackrock Depths,Golem Lord Argelmach,,,,
30 Jan 25,Zorblast,Mage,13,Silver Stream Mine,Dun Morogh,Tunnel Rat Geomancer,,,,
30 Jan 25,Kildarr,,45,Isle of Dread,Feralas,,Fatigue,,,
1 Feb 25,Keip,Rogue,60,,Blackrock Spire,,,,,
2 Feb 25,Jerrydruid,Druid,14,,Ragefire Chasm,,Lava,,,
4 Feb 25,Outcast,Paladin,60,,Molten Core,Firesworn,,Yes,https://www.twitch.tv/herrfate/clip/RelievedBashfulLocustAsianGlow-auJYQ6aDGrsGULyz,https://discord.com/channels/1151689920105164910/1158912037502599280/1336459023947530323
4 Feb 25,Meqq,Paladin,60,,Molten Core,Firesworn,,Yes,https://www.twitch.tv/herrfate/clip/RelievedBashfulLocustAsianGlow-auJYQ6aDGrsGULyz,https://discord.com/channels/1151689920105164910/1158912037502599280/1336459023947530323
7 Feb 25,Napzhul,Warrior,59,,Eastern Plaguelands,Putrid Shrieker ,,,,
7 Feb 25,Technotinker,Warlock,60,Plaguewood,Western Plaguelands,Ziggurat Protector ,,,,
8 Feb 25,Celebõrn,,60,,Blackrock Mountain,Scarshield Sentry ,,,,
10 Feb 25,Kvothex,,60,,Scholomance,Risen Lackey,,,,
11 Feb 25,Maaneschiold,,60,,Blackrock Spire,The Beast,,,,
11 Feb 25,Redemptíon,Warrior,53,,Burning Steps,Gor'tesh,,,,
11 Feb 25,Replay,Priest,60,,Dire Maul,,,,,
11 Feb 25,Qqs,Warrior,60,,Molten Core,Ragnaros,,Yes,,
13 Feb 25,Chillybear,Druid,34,,Scarlet Monastery,Herod,,,https://www.youtube.com/watch?v=ZyCuJm8sxxk,
14 Feb 25,Lightpew,Priest,60,,Silithus,,,,,
15 Feb 25,Mstrpancake,Warrior,56,,Burning Steps,Gor'tesh,,,,
17 Feb 25,Shakars,,,,,,,,,
18 Feb 25,Xyzpriesthc,Priest,60,,Blackrock Mountain,,Fall Damage,,,
18 Feb 25,Marcelle,Warlock,60,,Dire Maul,Gordok Brute,,,,
20 Feb 25,Necrash,,60,,Dire Maul,Gordok Captain,,,,
22 Feb 25,Misswaffles,,57,Sorrow Hill,Eastern Plaguelands,Skeletal Flayer,,,,
23 Feb 25,Sanguina,Warrior,60,,Tanaris,,Fall Dmg,,,
25 Feb 25,Meqq,,47,Mosh'Ogg Ogre Mound,Tanaris,Mosh'Ogg Lord,,,,
1 Mar 25,Mysticx,Mage,60,,Blackrock Spire,Defias Prisoner,,,,
1 Mar 25,Serpentes,Druid,60,,Scholomance,Scholomance Acolyte,,,https://youtu.be/Uk91CQJZk7c?si=XWtz_9hXPZ0ZhiN8&t=486,
2 Mar 25,Xyzpriestwo,Priest,58,,The Stockade,Defias Prisoner,Suicide,,,
4 Mar 25,Bengtbetong,Warrior,60,,Molten Core,Gehennas,,Yes,,
4 Mar 25,Kipling,Mage,60,,Onyxia's Lair,Onyxian Whelp,,Yes,https://www.twitch.tv/herrfate/clip/RelievedDreamyCoffeeBleedPurple-kBdl4uhGcJMfpniq,
5 Mar 25,Jerryhc,Priest,60,,Onyxia's Lair,Onyxia,,Yes,,
6 Mar 25,Jeppy,Warrior,60,,Stratholme,Skeletal Berserker,,,,
10 Mar 25,Druweedon,,,,Blackrock Depths,,,,,
11 Mar 25,Lailoma,Warlock,60,,Burning Steps,,,,
12 Mar 25,Exors,Hunter,60,,Dire Maul,Gordok Hyena,Dissconnect,,,
14 Mar 25,,Warrior,30,,,,,,,
14 Mar 25,Zirran,,,,,,,,,
16 Mar 25,Vag,Rogue,60,,Stratholme ,Caballo (mc 1stboss),,,,
17 Mar 25,Retfett,Paladin,47,Shalzaru's Lair,Feralas,Hatecrest Serpent Guard,Game Crashed,,,
17 Mar 25,Muggersbelt,Rogue,60,,Tanaris,,Fall Damage,,,
18 Mar 25,Fate,Mage,60,,Onyxia's Lair,Onyxia,,Yes,,
20 Mar 25,Wikick,Warrior,41,,Stranglethorn Vale,Bloodsail Buccaneer,,,,
20 Mar 25,Kakoshi,Rogue,60,Winterfall Village,Winerspring,High Chief Winterfall,Sub expired,,,
21 Mar 25,Offspank,Warrior,60,,Blackwing Lair,Nefarian,Shadowflame ,Yes,,
21 Mar 25,Shadybroth,Priest,21,,Shadowfang Keep,Wailing Guardsman,,,,
22 Mar 25,Maskot,,60,,,,,,,
23 Mar 25,Huxel,Warrior,60,,Blasted Lands,Archmage Allistarj ,,,,
23 Mar 25,Tisza,Warrior,60,,Blasted Lands,Archmage Allistarj ,,,,
23 Mar 25,Monza Warlock,Warlock,,,,,,,,
24 Mar 25,Shadytonk,,24,Splintree Post,Ashenvale,Splintree Guard,,,,
24 Mar 25,Duxel,,60,,,,,,,
27 Mar 25,Shortchilly,Warrior,60,Seradane,Hinterlands,Verdantine Oracle,,,,
2 Apr 25,Reprieve War,Warrior,25,,,,AFK,,,
6 Apr 25,Krôwka,Mage,33,,Arathi Highlands,,DC,,,
7 Apr 25,Kròwka,Mage,20,,The Stockade,,,,,
7 Apr 25,Kröwka,Mage,17,Longshore,Westfall,Murloc Oracle,,,,
7 Apr 25,Kròwka,Mage,10,,Wetlands,Wetlands Crocolisk,,,,
8 Apr 25,Daunustau,Paladin,60,,Blackwing Lair,,,Yes,,
12 Apr 25,Aoepikee,Mage,60,,Western Plaguelands,,DC,,,
14 Apr 25,Talinh,Mage,57,,,,,,,
15 Apr 25,Atherisrex,Warrior,60,,Blackwing Lair,Bone Constructs,,Yes,,
15 Apr 25,Ninju,Warrior,60,,Blackwing Lair,Broodlord Lashlayer,,Yes,,
17 Apr 25,Taxista,Warlock,13,,Loch Modan,,DC,,,
19 Apr 25,Cursefett,Warlock,23,,Ashenvale,Shadethicket Raincaller,,,,
29 Apr 25,Aerian,Druid,60,,Scholomance,Spectral Researcher,,,,
30 Apr 25,Scopecreep,Hunter,60,,Winterspring,Artorius the Doombringer,,,,
2 May 25,Mcveighpal,Paladin,44,,Uldaman,Shadowforge Surveyor,,,,
3 May 25,Zorvival,Hunter,17,Cliffspring Falls,Darkshore,Stormscale Wave Rider,,,,
3 May 25,RealXenia,Mage,60,,Silithus,Twilight Prophet,DC,,,
4 May 25,Rusken,Warrior,60,,Zul'gurub,Gazhranka,,Yes,,
6 May 25,Bearfett,Druid,60,,Blackrock Mountain,,Fall Damage,,https://discord.com/channels/1151689920105164910/1158912037502599280/1369414771585318922,
7 May 25,Taxista,Warlock,19,,Darkshore,,,,,
10 May 25,Mamishank,,,,,,,,,
12 May 25,Kobito,Paladin,60,,Burning Steps,Klinfran the Crazed,,,,
14 May 25,Sanguina,Warrior,60,,Tanaris,,Fall Dmg,,,
20 May 25,Embodimént,Rogue,60,,Silithus,Solenar the Slayer,,,https://discord.com/channels/1151689920105164910/1158912037502599280/1374365376590118952,
1 Jun 25,Chillycheese,Warlock,60,,Zul'gurub,Soulflayer,,Yes,https://discord.com/channels/1151689920105164910/1158912037502599280/1378824931680456825,
2 Jun 25,Xzangetsu,Mage,60,,Zul'gurub,Zulian Crocolisk ,,Yes,,
6 Jun 25,Huddley,Warrior,60,,Blackrock Spire,,Fall Dmg,,https://www.youtube.com/watch?v=VCGhhN0qVcw,
6 Jun 25,Marryme,Rogue,35,,Thousand Needles ,,Fall Dmg,,,
13 Jun 25,Erudeath,Druid,45,,Stromgarde Keep,Lord Falconcrest,,,,
13 Jun 25,Eredeath,Warrior,42,,Stromgarde Keep,Syndicate Prowler,,,,
15 Jun 25,Pawnda,Druid,55,,Felwood,,DC,,,
17 Jun 25,Zor,Mage,60,,Blackwing Lair,Blackwing Technician ,,Yes,,
20 Jun 25,Helevar war,Warrior,34,,,Murloc?,DC,,,
24 Jun 25,Panzerkampf,Warrior,60,,Blackwing Lair,Broodlord Lashlayer,1 shot,Yes,,
29 Jun 25,Sosemi ,Priest,60,,Westfall,,DC,,,
5 Jul 25,Bajiru,Mage,51,Sorrow Hill,Eastern Plaguelands,Slavering Ghoul,,,,
9 Jul 25,Yujirogue,Rogue,13,,Loch Modan,Loch Crocolisk,,,,
9 Jul 25,Shiesoae,Mage,19,The Dust Plains,Westfall,Riverpaw Taskmaster,,,,
9 Jul 25,Shies,Hunter,60,,Zul'gurub,Bloodlord Mandokir,,Yes,,
12 Jul 25,Shyshies,Mage,19,Inn,Stormwind,Mamiheals,Vale Debuff,,,
13 Jul 25,Pulletank,Warrior,60,,Scholomance,Probably zombies,,,,
14 Jul 25,Saltyman,Warrior,14,,Westfall,Defias Pillager,,,,
19 Jul 25,Baki,Paladin,60,Ravencrest Monument,Azshara,,Fall Damage,,,
25 Jul 25,Saltyaxe,warrior,25,,Ashenvale,Dark Strand Enforcer,,,,
18 Jul 25,Saltyman,Warrior,14,,Westfall,Defias Pillager,,,,
25 Jul 25,Saltyelf,Hunter,22,Mystral Lake,Ashenvale,Befouled Water Elemental ,,,,
26 Jul 25,Stonecrush,Warrior,60,,Silithus,,,,,
26 Jul 25,Mcveigh,Priest,60,Baradin Bay,Wetlands,,Drowned,,,
27 Jul 25,Hudley,Mage,60,Alcaz Island,Dustwallow Marsh,Strashaz Siren,,,,`;

        // Parse CSV data
        let data = d3.csvParse(csvData);
        
        // Clean and process the data
        data = data.filter(d => d.Date && d["Character Name"]).map(d => {
            // Parse date
            const dateStr = d.Date.trim();
            let parsedDate;
            if (dateStr.includes("Nov 24") || dateStr.includes("Dec 24")) {
                parsedDate = new Date("20" + dateStr.slice(-2), dateStr.includes("Nov") ? 10 : 11, parseInt(dateStr.split(" ")[0]));
            } else {
                const parts = dateStr.split(" ");
                const day = parseInt(parts[0]);
                const month = parts[1];
                const year = parseInt("20" + parts[2]);
                const monthMap = {
                    "Jan": 0, "Feb": 1, "Mar": 2, "Apr": 3, "May": 4, "Jun": 5,
                    "Jul": 6, "Aug": 7, "Sep": 8, "Oct": 9, "Nov": 10, "Dec": 11
                };
                parsedDate = new Date(year, monthMap[month], day);
            }
            
            return {
                ...d,
                date: parsedDate,
                level: d.Lvl ? parseInt(d.Lvl) : null,
                class: d.Class ? d.Class.trim() : null,
                location: d.Location ? d.Location.trim() : null,
                mob: d.Mob ? d.Mob.trim() : null,
                isRaid: d.Raid === "Yes",
                characterName: d["Character Name"].trim()
            };
        });

        // Global variables
        let filteredData = data;
        const tooltip = d3.select("#tooltip");
        
        // Color schemes
        const classColors = {
            "Warrior": "#C79C6E",
            "Paladin": "#F58CBA",
            "Hunter": "#ABD473",
            "Rogue": "#FFF569",
            "Priest": "#FFFFFF",
            "Mage": "#69CCF0",
            "Warlock": "#9482C9",
            "Druid": "#FF7D0A"
        };
        
        const levelRangeColors = {
            "1-20": "#ff6b6b",
            "21-40": "#4ecdc4",
            "41-59": "#45b7d1",
            "60": "#96ceb4"
        };

        // Initialize the dashboard
        function init() {
            populateFilters();
            updateStats();
            createCharts();
        }

        // Populate filter dropdowns
        function populateFilters() {
            // Class filter
            const classes = [...new Set(data.filter(d => d.class).map(d => d.class))].sort();
            const classSelect = d3.select("#classFilter");
            classSelect.selectAll("option:not(:first-child)").remove();
            classes.forEach(cls => {
                classSelect.append("option").attr("value", cls).text(cls);
            });

            // Location filter
            const locations = [...new Set(data.filter(d => d.location).map(d => d.location))].sort();
            const locationSelect = d3.select("#locationFilter");
            locationSelect.selectAll("option:not(:first-child)").remove();
            locations.forEach(loc => {
                locationSelect.append("option").attr("value", loc).text(loc);
            });

            // Add event listeners
            d3.select("#classFilter").on("change", updateDashboard);
            d3.select("#levelFilter").on("change", updateDashboard);
            d3.select("#locationFilter").on("change", updateDashboard);
            d3.select("#raidFilter").on("change", updateDashboard);
        }

        // Update dashboard based on filters
        function updateDashboard() {
            applyFilters();
            updateStats();
            updateCharts();
        }

        // Apply current filters
        function applyFilters() {
            const classFilter = d3.select("#classFilter").node().value;
            const levelFilter = d3.select("#levelFilter").node().value;
            const locationFilter = d3.select("#locationFilter").node().value;
            const raidFilter = d3.select("#raidFilter").node().value;

            filteredData = data.filter(d => {
                if (classFilter !== "all" && d.class !== classFilter) return false;
                if (locationFilter !== "all" && d.location !== locationFilter) return false;
                if (raidFilter === "yes" && !d.isRaid) return false;
                if (raidFilter === "no" && d.isRaid) return false;
                
                if (levelFilter !== "all" && d.level) {
                    if (levelFilter === "1-20" && (d.level < 1 || d.level > 20)) return false;
                    if (levelFilter === "21-40" && (d.level < 21 || d.level > 40)) return false;
                    if (levelFilter === "41-59" && (d.level < 41 || d.level > 59)) return false;
                    if (levelFilter === "60" && d.level !== 60) return false;
                }
                
                return true;
            });
        }

        // Update statistics overview
        function updateStats() {
            const totalDeaths = filteredData.length;
            const uniqueCharacters = new Set(filteredData.map(d => d.characterName)).size;
            const raidDeaths = filteredData.filter(d => d.isRaid).length;
            const avgLevel = d3.mean(filteredData.filter(d => d.level), d => d.level);
            const mostDeadlyLocation = d3.rollup(filteredData.filter(d => d.location), v => v.length, d => d.location);
            const topLocation = mostDeadlyLocation.size > 0 ? [...mostDeadlyLocation.entries()].sort((a, b) => b[1] - a[1])[0] : null;

            const statsHtml = `
                <div class="stat-card">
                    <h3>Total Deaths</h3>
                    <div class="value">${totalDeaths}</div>
                </div>
                <div class="stat-card">
                    <h3>Characters Lost</h3>
                    <div class="value">${uniqueCharacters}</div>
                </div>
                <div class="stat-card">
                    <h3>Raid Deaths</h3>
                    <div class="value">${raidDeaths}</div>
                </div>
                <div class="stat-card">
                    <h3>Avg Death Level</h3>
                    <div class="value">${avgLevel ? Math.round(avgLevel) : 'N/A'}</div>
                </div>
                <div class="stat-card">
                    <h3>Deadliest Zone</h3>
                    <div class="value" style="font-size: 1.2em;">${topLocation ? topLocation[0] : 'N/A'}</div>
                </div>
            `;
            d3.select("#stats-overview").html(statsHtml);
        }

        // Create all charts
        function createCharts() {
            createClassChart();
            createLevelChart();
            createTimelineChart();
            createLocationChart();
            createMobChart();
        }

        // Update all charts
        function updateCharts() {
            d3.select("#classChart").selectAll("*").remove();
            d3.select("#levelChart").selectAll("*").remove();
            d3.select("#timelineChart").selectAll("*").remove();
            d3.select("#locationChart").selectAll("*").remove();
            d3.select("#mobChart").selectAll("*").remove();
            createCharts();
        }

        // Create class distribution chart
        function createClassChart() {
            const margin = {top: 20, right: 20, bottom: 40, left: 40};
            const width = 400 - margin.left - margin.right;
            const height = 300 - margin.bottom - margin.top;

            const classCounts = d3.rollup(filteredData.filter(d => d.class), v => v.length, d => d.class);
            const classData = Array.from(classCounts, ([key, value]) => ({class: key, count: value}))
                .sort((a, b) => b.count - a.count);

            const svg = d3.select("#classChart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom);

            const g = svg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const x = d3.scaleBand()
                .domain(classData.map(d => d.class))
                .range([0, width])
                .padding(0.1);

            const y = d3.scaleLinear()
                .domain([0, d3.max(classData, d => d.count)])
                .range([height, 0]);

            g.selectAll(".bar")
                .data(classData)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", d => x(d.class))
                .attr("width", x.bandwidth())
                .attr("y", d => y(d.count))
                .attr("height", d => height - y(d.count))
                .attr("fill", d => classColors[d.class] || "#666")
                .on("mouseover", function(event, d) {
                    tooltip.style("opacity", 1)
                        .html(`<strong>${d.class}</strong><br/>Deaths: ${d.count}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 10) + "px");
                })
                .on("mouseout", function() {
                    tooltip.style("opacity", 0);
                });

            g.append("g")
                .attr("class", "axis")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .selectAll("text")
                .style("text-anchor", "end")
                .attr("dx", "-.8em")
                .attr("dy", ".15em")
                .attr("transform", "rotate(-45)");

            g.append("g")
                .attr("class", "axis")
                .call(d3.axisLeft(y));
        }

        // Create level distribution chart
        function createLevelChart() {
            const margin = {top: 20, right: 20, bottom: 40, left: 40};
            const width = 400 - margin.left - margin.right;
            const height = 300 - margin.bottom - margin.top;

            const levelData = filteredData.filter(d => d.level);
            const levelRanges = [
                {range: "1-20", count: levelData.filter(d => d.level >= 1 && d.level <= 20).length},
                {range: "21-40", count: levelData.filter(d => d.level >= 21 && d.level <= 40).length},
                {range: "41-59", count: levelData.filter(d => d.level >= 41 && d.level <= 59).length},
                {range: "60", count: levelData.filter(d => d.level === 60).length}
            ];

            const svg = d3.select("#levelChart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom);

            const g = svg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const x = d3.scaleBand()
                .domain(levelRanges.map(d => d.range))
                .range([0, width])
                .padding(0.1);

            const y = d3.scaleLinear()
                .domain([0, d3.max(levelRanges, d => d.count)])
                .range([height, 0]);

            g.selectAll(".bar")
                .data(levelRanges)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", d => x(d.range))
                .attr("width", x.bandwidth())
                .attr("y", d => y(d.count))
                .attr("height", d => height - y(d.count))
                .attr("fill", d => levelRangeColors[d.range])
                .on("mouseover", function(event, d) {
                    tooltip.style("opacity", 1)
                        .html(`<strong>Level ${d.range}</strong><br/>Deaths: ${d.count}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 10) + "px");
                })
                .on("mouseout", function() {
                    tooltip.style("opacity", 0);
                });

            g.append("g")
                .attr("class", "axis")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x));

            g.append("g")
                .attr("class", "axis")
                .call(d3.axisLeft(y));
        }

        // Create timeline chart
        function createTimelineChart() {
            const margin = {top: 20, right: 20, bottom: 60, left: 40};
            const width = 800 - margin.left - margin.right;
            const height = 300 - margin.bottom - margin.top;

            const timeData = d3.rollup(filteredData, v => v.length, d => d3.timeMonth(d.date));
            const timeArray = Array.from(timeData, ([key, value]) => ({date: key, count: value}))
                .sort((a, b) => a.date - b.date);

            const svg = d3.select("#timelineChart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom);

            const g = svg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const x = d3.scaleTime()
                .domain(d3.extent(timeArray, d => d.date))
                .range([0, width]);

            const y = d3.scaleLinear()
                .domain([0, d3.max(timeArray, d => d.count)])
                .range([height, 0]);

            const line = d3.line()
                .x(d => x(d.date))
                .y(d => y(d.count))
                .curve(d3.curveMonotoneX);

            g.append("path")
                .datum(timeArray)
                .attr("fill", "none")
                .attr("stroke", "#4ecdc4")
                .attr("stroke-width", 3)
                .attr("d", line);

            g.selectAll(".dot")
                .data(timeArray)
                .enter().append("circle")
                .attr("class", "dot")
                .attr("cx", d => x(d.date))
                .attr("cy", d => y(d.count))
                .attr("r", 5)
                .attr("fill", "#ff6b6b")
                .on("mouseover", function(event, d) {
                    tooltip.style("opacity", 1)
                        .html(`<strong>${d3.timeFormat("%B %Y")(d.date)}</strong><br/>Deaths: ${d.count}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 10) + "px");
                })
                .on("mouseout", function() {
                    tooltip.style("opacity", 0);
                });

            g.append("g")
                .attr("class", "axis")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x).tickFormat(d3.timeFormat("%b %Y")))
                .selectAll("text")
                .style("text-anchor", "end")
                .attr("dx", "-.8em")
                .attr("dy", ".15em")
                .attr("transform", "rotate(-45)");

            g.append("g")
                .attr("class", "axis")
                .call(d3.axisLeft(y));
        }

        // Create location chart
        function createLocationChart() {
            const margin = {top: 20, right: 20, bottom: 80, left: 40};
            const width = 400 - margin.left - margin.right;
            const height = 300 - margin.bottom - margin.top;

            const locationCounts = d3.rollup(filteredData.filter(d => d.location), v => v.length, d => d.location);
            const locationData = Array.from(locationCounts, ([key, value]) => ({location: key, count: value}))
                .sort((a, b) => b.count - a.count)
                .slice(0, 10); // Top 10

            const svg = d3.select("#locationChart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom);

            const g = svg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const x = d3.scaleBand()
                .domain(locationData.map(d => d.location))
                .range([0, width])
                .padding(0.1);

            const y = d3.scaleLinear()
                .domain([0, d3.max(locationData, d => d.count)])
                .range([height, 0]);

            g.selectAll(".bar")
                .data(locationData)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", d => x(d.location))
                .attr("width", x.bandwidth())
                .attr("y", d => y(d.count))
                .attr("height", d => height - y(d.count))
                .attr("fill", "#45b7d1")
                .on("mouseover", function(event, d) {
                    tooltip.style("opacity", 1)
                        .html(`<strong>${d.location}</strong><br/>Deaths: ${d.count}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 10) + "px");
                })
                .on("mouseout", function() {
                    tooltip.style("opacity", 0);
                });

            g.append("g")
                .attr("class", "axis")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .selectAll("text")
                .style("text-anchor", "end")
                .attr("dx", "-.8em")
                .attr("dy", ".15em")
                .attr("transform", "rotate(-45)");

            g.append("g")
                .attr("class", "axis")
                .call(d3.axisLeft(y));
        }

        // Create mob chart
        function createMobChart() {
            const margin = {top: 20, right: 20, bottom: 80, left: 40};
            const width = 400 - margin.left - margin.right;
            const height = 300 - margin.bottom - margin.top;

            const mobCounts = d3.rollup(filteredData.filter(d => d.mob), v => v.length, d => d.mob);
            const mobData = Array.from(mobCounts, ([key, value]) => ({mob: key, count: value}))
                .sort((a, b) => b.count - a.count)
                .slice(0, 10); // Top 10

            const svg = d3.select("#mobChart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom);

            const g = svg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const x = d3.scaleBand()
                .domain(mobData.map(d => d.mob))
                .range([0, width])
                .padding(0.1);

            const y = d3.scaleLinear()
                .domain([0, d3.max(mobData, d => d.count)])
                .range([height, 0]);

            g.selectAll(".bar")
                .data(mobData)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", d => x(d.mob))
                .attr("width", x.bandwidth())
                .attr("y", d => y(d.count))
                .attr("height", d => height - y(d.count))
                .attr("fill", "#ff6b6b")
                .on("mouseover", function(event, d) {
                    tooltip.style("opacity", 1)
                        .html(`<strong>${d.mob}</strong><br/>Kills: ${d.count}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 10) + "px");
                })
                .on("mouseout", function() {
                    tooltip.style("opacity", 0);
                });

            g.append("g")
                .attr("class", "axis")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .selectAll("text")
                .style("text-anchor", "end")
                .attr("dx", "-.8em")
                .attr("dy", ".15em")
                .attr("transform", "rotate(-45)");

            g.append("g")
                .attr("class", "axis")
                .call(d3.axisLeft(y));
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>